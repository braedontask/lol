-- select * from user_notification_type_preference where user_id = 13115602 -- select * from user_notification_type_preference where user_id = 172239045 SELECT u.user_id, ndt.id -- FROM (VALUES (13115602)) u(user_id) FROM (VALUES (172239045)) u(user_id) CROSS JOIN notification_type nt CROSS JOIN notification_delivery_type ndt LEFT OUTER JOIN user_notification_category_preference uncp ON uncp.user_id = u.user_id AND (uncp.category_id = 0 OR uncp.category_id = nt.category_id) AND uncp.delivery_type_id = ndt.id LEFT OUTER JOIN user_notification_type_preference untp ON untp.user_id = u.user_id AND (untp.type_id = 0 OR untp.type_id = nt.id) AND untp.delivery_type_id = ndt.id WHERE nt.id = 31 AND COALESCE(uncp.enabled, ndt.default_enabled) AND COALESCE(untp.enabled, ndt.default_enabled)